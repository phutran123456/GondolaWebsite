!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("gondola-telemetry",[],t):"object"==typeof exports?exports["gondola-telemetry"]=t():e["gondola-telemetry"]=t()}(global,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r="Gondola Telemetry:";t.logger=new class{constructor(){this.isActive=!0}setActive(e){this.isActive=e}info(e){this.isActive&&console.log(`${r} ${e}`)}warn(e,t){this.error(e,t)}error(e,t){this.isActive&&(t?console.error(`${r} ${e}`,t):console.error(`${r} ${e}`))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Extension=0]="Extension",e[e.SpreadSheetEditor=1]="SpreadSheetEditor",e[e.HeliumFW=2]="HeliumFW",e[e.TestBuilder=3]="TestBuilder",e[e.Environment=4]="Environment"}(t.EventCategory||(t.EventCategory={})),function(e){e[e.StartupExtension=0]="StartupExtension",e[e.StartGSE=1]="StartGSE"}(t.UserTimingVariable||(t.UserTimingVariable={}))},function(e,t){e.exports=require("node-machine-id")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4);t.captureTelemetry=r.captureTelemetry,t.EventCategory=r.EventCategory,t.sendActionsStatistic=r.sendActionsStatistic,t.sendTelemetryEvent=r.sendTelemetryEvent;const o=n(10);t.EventName={GenerateReport:"GenerateReport",StartTest:"StartTest",EndTest:"EndTest"};const i={isTestExecuted:!0,av:o.getGondolaVersion()};t.envInfo=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),o=n(1);t.EventCategory=o.EventCategory,t.UserTimingVariable=o.UserTimingVariable;const i=n(0),s=n(9);let c;function a(){return c||(c=new r.Analyzer),c}async function u(e,t,n,r,s,c,u,l,d){if("boolean"==typeof e){if(!1===e)return}else if(!1===e())return;await new Promise(async(e,f)=>{try{let f=!0;d&&("boolean"==typeof d.isTestExecuted?(f=!d.isTestExecuted,d.isSkipped=t!==o.EventCategory.HeliumFW&&d.isTestExecuted):"function"==typeof d.isTestExecuted&&(f=!1===d.isTestExecuted(),d.isSkipped=t!==o.EventCategory.HeliumFW&&!0===d.isTestExecuted())),i.logger.setActive(f),i.logger.info(JSON.stringify(u)),i.logger.info(JSON.stringify(l)),i.logger.info(`${s} - ${c}`),i.logger.info(JSON.stringify(d));const p=a();if(p)if(u&&"object"==typeof u){const e=u;for(const[n,r]of Object.entries(e))r&&await p.event(t,n,r,d)}else p.event(t,n,r,d);e()}catch(e){i.logger.error("Failed to send analytics: "+e),f()}})}t.sendActionsStatistic=async function(e,t,n){if("boolean"==typeof e){if(!1===e)return}else if(!1===e())return;await new Promise(async(e,r)=>{try{const e=o.EventCategory.HeliumFW;let r=!0;n&&("boolean"==typeof n.isTestExecuted?(r=!n.isTestExecuted,n.isSkipped=e!==o.EventCategory.HeliumFW&&n.isTestExecuted):"function"==typeof n.isTestExecuted&&(r=!1===n.isTestExecuted(),n.isSkipped=e!==o.EventCategory.HeliumFW&&!0===n.isTestExecuted())),i.logger.setActive(r),i.logger.info(JSON.stringify(n));const s=a();if(s)for(const[r,o]of t)await s.trackAction(e,r,o,n)}catch(e){i.logger.error("Failed to send analytics: "+e),r()}e()})},t.sendLocatorsStatistic=async function(e,t,n){if("boolean"==typeof e){if(!1===e)return}else if(!1===e())return;const r=o.EventCategory.HeliumFW;let s=!0;n&&("boolean"==typeof n.isTestExecuted?(s=!n.isTestExecuted,n.isSkipped=r!==o.EventCategory.HeliumFW&&n.isTestExecuted):"function"==typeof n.isTestExecuted&&(s=!1===n.isTestExecuted(),n.isSkipped=r!==o.EventCategory.HeliumFW&&!0===n.isTestExecuted())),i.logger.setActive(s),i.logger.info(JSON.stringify(n));const c=a();if(c)for(const[e,o]of t)await c.trackLocator(r,e,o,n)},t.sendTelemetryEvent=u,t.captureTelemetry=function(e,t,n,r,o,i=!0,c){return(a,l,d)=>{const f=d.value;return d.value=function(...a){if(!1===e())return f.apply(this,a);const l=new s.StopWatch;if(!i)return u(e,t,n,r,l.startTime,void 0,o,void 0,c),f.apply(this,a);const d=f.apply(this,a);return d&&"function"==typeof d.then&&"function"==typeof d.catch?d.then(i=>(u(e,t,n,r,l.startTime,l.elapsedTime,o,void 0,c),i)).catch(i=>{(o=o||{}).failed=!0,u(e,t,n,r,l.startTime,l.elapsedTime,o,i,c)}):u(e,t,n,r,l.startTime,l.elapsedTime,o,void 0,c),d},d}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),o=n(0),i=n(6);t.Analyzer=class{constructor(){o.logger.info("Create new GAReporter successfully"),this.report=new i.GAReporter}async trackAction(e,t,n,o){if(this.report){const i={t:"event",ec:r.EventCategory[e],el:t,ea:"Action",ev:n};await this.report.send(i,o)}}async trackLocator(e,t,n,o){if(this.report){const i={t:"event",ec:r.EventCategory[e],el:t,ea:"LocatorStrategy",ev:n};return this.report.send(i,o)}}event(e,t,n,o){if(this.report){const i={ec:r.EventCategory[e],ea:t,t:"event",el:n};this.report.send(i,o)}}error(e,t,n){const r={exd:e.split(/[\n\{\/\\]/)[0].substring(0,150).trim(),exf:t?1:0,t:"exception"};this.report.send(r,n)}time(e,t,n,o,i){const s={t:"timing",utc:r.EventCategory[e],utl:o,utt:Math.round(n),utv:r.UserTimingVariable[t]};this.report.send(s,i)}}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(7)),i=n(2),s=r(n(8)),c=n(0),a=()=>"true"===process.env.GS_DEBUG_MODE,u="UA-155073229-1",l="UA-134732439-2";t.GAReporter=class{async send(e,t){if(t&&!0===t.isSkipped)return;const n={aip:1,an:"Gondola Studio",av:t&&t.av?t.av:"",tid:"true"===process.env.GS_TESTING_MODE?u:l,ul:t&&t.ul?t.ul:"",v:"1"};let r;r=t&&t.cid?t.cid:await i.machineId(!0),Object.assign(n,{cid:r}),t&&t.uid&&Object.assign(n,{uid:t.uid}),Object.assign(n,e),a()&&c.logger.info(JSON.stringify(n));const d={headers:{"Content-Type":"application/x-www-form-urlencoded"},hostname:"www.google-analytics.com",method:"POST",path:a()?"/debug/collect":"/collect",port:443};await new Promise(t=>{try{const r=o.request(d,n=>{a()&&n.on("data",t=>{try{const n=JSON.parse(t.toString());n&&n.hitParsingResult&&!0===n.hitParsingResult[0].valid?c.logger.info("{Event category: "+e.ec+"} {Event name: "+e.ea+"} sent OK!"):n&&n.hitParsingResult&&!1===n.hitParsingResult[0].valid?c.logger.warn(t.toString()):c.logger.warn("Unexpected GA debug response: "+t.toString())}catch(e){c.logger.warn("Error in GA debug response: "+t.toString())}}),(!n||!n.statusCode||n.statusCode<200||n.statusCode>300)&&c.logger.info(`Failed to send analytics ${n&&n.statusCode}: ${n&&n.statusMessage}`),t()});r.on("error",e=>{a()&&c.logger.error("Failed to make http request: "+e),t()}),r.write(s.stringify(n)),r.end()}catch(e){c.logger.error("Failed to send analytics: "+e),t()}})}}},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("querystring")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StopWatch=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}get startTime(){return this.started}reset(){this.started=Date.now()}}},function(e,t,n){"use strict";(function(e){var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(11),{getConfig:i}=n(12),s=r(n(13)),c=n(2),a=r(n(14)),u=r(n(15));function l(){const e=u.resolve(".","./node_modules/gondolajs/package.json"),t=s.readFileSync(e,"utf-8");return JSON.parse(t).version}function d(){let e="./gondola.json";const t=process.argv;if(t.includes("--config")){const n=t.indexOf("--config")+1;n<t.length&&(e=t[n])}else if(t.includes("-c")){const n=t.indexOf("-c")+1;n<t.length&&(e=t[n])}return e}function f(){let e;const t=d();if(s.existsSync(t)){const r=u.resolve(".",t);e=i(r);const o=process.argv;if(o.includes("--override")||o.includes("-o"))try{const t=o.indexOf("--override")||o.indexOf("-o");if(t+1<o.length){const r=o[t+1];if(r&&"-"!==r.charAt(0)){const t=JSON.parse(r);n(16)(e,t)}}}catch(e){}}return e}var p,g;function y(){return e.split("node_modules")[0]}function v(){return a.type()+" "+a.release()}function m(){const e=process.argv,t=e.findIndex(e=>"--reporter"===e||"--R"===e);let n="";return t>=0&&(n=e[t+1]),n}t.isEmpty=e=>null===e||!(Object.keys(e)||e).length,t.getLocatorString=function(e){return"object"==typeof e&&(e=JSON.stringify(e)),new o(e).toString()},t.getGondolaVersion=l,t.getConfigPath=d,t.isAllowedTelemetry=function(){let e=!0;const t=f();return t&&!1===t.telemetry&&(e=t.telemetry),e},t.getTokenInfo=function(){let e="";const t=f();return t&&""!==t.licenseToken&&void 0!==t.licenseToken&&(e=t.licenseToken),e},t.getLSInfo=function(){let e="";const t=f();return t&&""!==t.licenseServer&&void 0!==t.licenseServer&&(e=t.licenseServer),e},(g=p||(p={})).unknown="unknown",g.mobile="mobile",g.web="web",g.enterprise="enterprise",t.getAgentType=function(){let e=p.unknown;const t=d();if(s.existsSync(t)){const n=u.resolve(".",t),r=i(n);r&&r.helpers&&(r.helpers.Protractor||r.helpers.WebDriver?e=p.web:r.helpers.Appium&&(e=r.helpers.Appium.desiredCapabilities&&r.helpers.Appium.desiredCapabilities.browserName?p.web:p.mobile))}return e},t.getRootDir=y,t.resolveAttachFileDir=function(e){const t=u.relative(global.codecept_dir,y());return u.join(t,e)},t.isXPath=function(e){const t=e.replace(/^\(+/,"").substr(0,2);return"//"===t||"./"===t},t.getOS=v,t.getReporterName=m,t.captureUserEnvironment=function(e){const t={};return e&&(t.BrowserName=e.browserName,t.BrowserVersion=e.version||e.browserVersion,t.Platform=v(),t.GondolaVersion=l(),t.Reporter=m(),t.DeviceManufacturer=e.deviceManufacturer,t.DeviceModel=e.deviceModel,t.DeviceScreenSize=e.deviceScreenSize),t},t.getMachineID=async function(){return await c.machineId(!0)}}).call(this,"built")},function(e,t){e.exports=require("codeceptjs/lib/locator")},function(e,t){e.exports=require("codeceptjs/lib/command/utils")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("lodash.merge")}])}));