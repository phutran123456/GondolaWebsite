"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const errors=__importStar(require("../../errors")),Utils=__importStar(require("../utils/WebUtils")),message_1=require("../../message"),util_1=require("../../util"),ElementNotFound=require("codeceptjs/lib/helper/errors/ElementNotFound");class WebDriverWrapper{async dragAndDrop(e,t,r){e&&this._instanceOfCoordinate(e)?t&&this._instanceOfCoordinate(t)?await this.dragAndDropMouse(e,t,r):await this.dragAndDropToElement(e,t,r):t&&this._instanceOfCoordinate(t)?await this.dragElementToCoordinate(e,t,r):await this.dragElementToElement(e,t,r)}async enter(e,t){let r;try{r=await this.helper._locate(e,!0)}catch(t){throw new ElementNotFound(util_1.getLocatorString(e))}const o=r[0],i=await o.isClickable(),a=await o.isDisplayed();if(!i||!a)throw new errors.GError(errors.GErrorKey.ElementNotEnabledOrDisplayed,e);await this.helper.fillField(e,t)}async getControlProperty(e,t){const r=await Utils.findFirstElement(this.helper,e);return await r.getProperty(t)}async moveMouse(e,t){if(e&&this._instanceOfCoordinate(e)){const t="//html/body";await this.helper.moveCursorTo(t,e.x,e.y)}else if(""===e&&(e="//html/body"),void 0===t){const t=await this.helper._locate(e,!0);if(!t||0===t.length)throw new ElementNotFound(e);const r=await t[0].getLocation(),o=await t[0].getSize(),i=r.x+o.width/2,a=r.y+o.height/2;await this.helper.moveCursorTo(e,i,a)}else await this.helper.moveCursorTo(e,t.x,t.y)}async selectByIndex(e,t){if(t<0)throw new errors.NegativeNumberError;const r=await Utils.findFirstElement(this.helper,e),o=(await r.getTagName()).toLowerCase(),i=Utils.getElementId(r);let a="option";"ul"===o&&(a="li");const n=this.helper.browser,s=await n.findElementsFromElement(i,"css selector",a);if(0===s.length)throw new errors.EmptySelectControl;if(s.length-1<t)throw new errors.InvalidSelectOptionIndex(t,s.length);if("select"===o)await r.selectByIndex(t);else{if("ul"!==o)throw new errors.InvalidSelectOptionStrategy(o);{const e=Utils.getElementId(s[t]);if(e)return n.elementClick(e)}}}async setState(e,t){var r,o,i,a,n,s;const l=this.helper.browser,h=await Utils.findFirstElement(this.helper,e);if(!await h.isEnabled())throw new errors.GError(errors.GErrorKey.DisabledElementErr,e);const w=Utils.getElementId(h);!1===await h.isDisplayedInViewport()&&await h.scrollIntoView();if(await l.isElementSelected(w)!==t){const e="safari"===(null===(i=null===(o=null===(r=this.helper.browser)||void 0===r?void 0:r.capabilities)||void 0===o?void 0:o.browserName)||void 0===i?void 0:i.toLowerCase()),t=null===(s=null===(n=null===(a=this.helper.browser)||void 0===a?void 0:a.capabilities)||void 0===n?void 0:n.browserVersion)||void 0===s?void 0:s.startsWith("13.0");e&&t?await this.helper.executeScript(e=>{const t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)},h):await l.elementClick(w)}}async scrollIntoView(e,t){return await Utils.scrollIntoView(this.helper,e,t)}async scrollTo(e,t=0,r=0){await this.helper.scrollTo(e,t,r)}async getElementBounds(e){const t=await this.helper.grabElementBoundingRect(e);return{left:t.x,top:t.y,width:t.width,height:t.height}}async waitForElementProperty(e,t,r,o){const i=await Utils.findFirstElement(this.helper,e);if(!await this.helper.executeScript((e,t)=>void 0!==e[t],i,t))throw new errors.InvalidElementPropertyError(e,t);const a=message_1.format(message_1.localize(errors.GErrorKey.TimeOutForElementHasProptery),e,t,r);await this.helper.browser.waitUntil(async()=>await i.getProperty(t)===r,1e3*o,a,500)}async waitForValueChanged(e,t,r,o){const i=await Utils.findFirstElement(this.helper,e);if(!await this.helper.executeScript((e,t)=>void 0!==e[t],i,t))throw new errors.InvalidElementPropertyError(e,t);const a=message_1.format(message_1.localize(errors.GErrorKey.TimeoutForValueChange),e,t),n=await i.getProperty(t);o&&n===o||await this.helper.browser.waitUntil(async()=>await i.getProperty(t)!==n,1e3*r,a,500)}_instanceOfCoordinate(e){return"string"!=typeof e&&("x"in e&&"y"in e)}async dragElementToElement(e,t,r){await this.scrollToElement(e);const o=await this.getElementCoordinate(e),i=await this.getElementCoordinate(t);await this.dragAndDropMouse(o,i,r)}async dragElementToCoordinate(e,t,r){await this.scrollToElement(e);const o=await this.getElementCoordinate(e);await this.dragAndDropMouse(o,t,r)}async dragAndDropToElement(e,t,r){const o=await this.getElementCoordinate(t);await this.dragAndDropMouse(e,o,r)}async dragAndDropMouse(e,t,r){const o=this.helper.browser,i=Math.floor(t.x-e.x),a=Math.floor(t.y-e.y);o.isW3C?(await o.performActions([{type:"pointer",id:"finger1",parameters:{pointerType:"mouse"},actions:[{type:"pointerMove",duration:0,x:e.x,y:e.y},{type:"pointerDown",button:0},{type:"pause",duration:750},{type:"pointerMove",origin:"pointer",duration:r,x:i,y:a},{type:"pointerUp",button:0}]}]),await o.releaseActions()):(await o.moveToElement(null,Math.floor(e.x),Math.floor(e.y)),await o.buttonDown(0),await this.moveIt(o,e,t,r),await o.buttonUp(0),await o.moveToElement(null,Math.floor(-1*t.x),Math.floor(-1*t.y)))}async moveIt(e,t,r,o){let i=1500;void 0!==o&&(i=o);const a=Math.floor(i/30),n=(r.x-t.x)/i,s=(r.y-t.y)/i;let l=Math.floor(t.x),h=Math.floor(t.y);for(let r=1;r<=a;r++){const o=Math.floor(t.x+30*n*r),i=Math.floor(t.y+30*s*r);await e.moveToElement(null,o-l,i-h),await e.pause(20),l=o,h=i}await e.moveToElement(null,Math.floor(r.x-l),Math.floor(r.y-h))}async getElementCoordinate(e){const t=this.helper.browser,r=await Utils.findFirstElement(this.helper,e),o=Utils.getElementId(r);let i={x:0,y:0};if(t.getElementLocationInView){const e=await t.getElementLocationInView(o),r=await t.getElementSize(o);i={x:e.x+r.width/2,y:e.y+r.height/2}}else if(t.getElementRect){const e=await t.getElementRect(o);i={x:Math.floor(e.x+e.width/2),y:Math.floor(e.y+e.height/2)}}return i}async scrollToElement(e){const t=await Utils.findFirstElement(this.helper,e);await t.scrollIntoView()}async performClick(e,t){const r=this.helper.browser,o=Math.floor(e),i=Math.floor(t);if(r.isW3C)return await r.performActions([{type:"pointer",id:"mouse0",parameters:{pointerType:"mouse"},actions:[{type:"pointerMove",duration:0,x:o,y:i},{type:"pointerDown",button:0},{type:"pause",duration:500},{type:"pointerUp",button:0}]}]);await r.moveToElement(null,Math.floor(o),Math.floor(i)),await r.buttonDown(0),await r.buttonUp(0),await r.moveToElement(null,0,0)}}exports.WebDriverWrapper=WebDriverWrapper,exports.default=new WebDriverWrapper;
//# sourceMappingURL=../../../debug/helper/wrapper/webwrapper.js.map
